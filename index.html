<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SmartBin</title>

<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body{margin:0;font-family:'Kanit',sans-serif;background:#eef2f6;height:100vh;display:flex;flex-direction:column;}
.header{padding:15px 25px;background:white;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.header h2{margin:0;font-weight:600;}
.header span{font-size:13px;color:#888;}
.tabs{display:flex;justify-content:center;margin:15px;}
.tab{padding:10px 25px;border-radius:25px;background:#e5e7eb;margin:0 5px;cursor:pointer;}
.tab.active{background:linear-gradient(90deg,#10b981,#2563eb);color:white;}
.page{display:none;flex:1;}
.camera-card{margin:0 40px;background:#0f1c2e;border-radius:20px;flex:1;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;}
canvas{width:100%;height:100%;object-fit:cover;}
.placeholder{color:#94a3b8;text-align:center;}
.switch-btn{position:absolute;top:15px;right:15px;background:rgba(255,255,255,0.2);border:none;border-radius:50%;width:40px;height:40px;color:white;cursor:pointer;display:none;}
.result-panel{background:white;padding:20px 30px;border-radius:20px 20px 0 0;}
.result-row{margin-bottom:12px;}
.progress-track{height:18px;background:#eee;border-radius:8px;overflow:hidden;position:relative;}
.progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#10b981,#3b82f6);transition:0.2s;}
.percent-text{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:12px;}
.bottom-btn{margin:15px 40px 25px;padding:14px;border:none;border-radius:30px;background:linear-gradient(90deg,#10b981,#2563eb);color:white;font-size:16px;cursor:pointer;}
.scan-frame{position:absolute;width:65%;height:55%;border:2px solid rgba(255,255,255,0.7);border-radius:20px;pointer-events:none;}
</style>
</head>

<body>

<div class="header">
<h2>SmartBin</h2>
<span>AI Plastic Bottle Detector</span>
</div>

<div class="tabs">
<div class="tab active" onclick="showCamera()">üì∑ ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö</div>
<div class="tab" onclick="showInfo()">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</div>
</div>

<div id="cameraPage" class="page" style="display:flex;flex-direction:column;">
<div class="camera-card">

<div class="placeholder" id="placeholder">
<span class="material-icons" style="font-size:60px;">no_photography</span>
<p>‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î</p>
</div>

<button class="switch-btn" id="switchBtn" onclick="switchCamera()">
<span class="material-icons">flip_camera_ios</span>
</button>

<div id="webcam-container"></div>
<div class="scan-frame"></div>

</div>

<div class="result-panel" id="result-panel"></div>

<button class="bottom-btn" onclick="toggleCamera()">‡πÄ‡∏õ‡∏¥‡∏î / ‡∏õ‡∏¥‡∏î ‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
</div>

<div id="infoPage" class="page">
<div style="padding:40px;">
<h3>PET</h3>
<p>‡∏Ç‡∏ß‡∏î‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏° ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡∏á‡πà‡∏≤‡∏¢</p>
<h3>HDPE</h3>
<p>‡∏Ç‡∏ß‡∏î‡πÅ‡∏ä‡∏°‡∏û‡∏π ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô</p>
<h3>Other</h3>
<p>‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∑‡πà‡∏ô ‡∏£‡∏µ‡πÑ‡∏ã‡πÄ‡∏Ñ‡∏¥‡∏•‡∏¢‡∏≤‡∏Å</p>
</div>
</div>

<script>

const URL="https://teachablemachine.withgoogle.com/models/EV-mbCqpx/";

let model, webcam, maxPredictions;
let isCameraOn=false;
let currentFacingMode="environment";
let loopId=null;

/* ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• */
async function loadModel(){
model=await tmImage.load(URL+"model.json",URL+"metadata.json");
maxPredictions=model.getTotalClasses();
createBars();
}
loadModel();

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á progress bars */
function createBars(){
const panel=document.getElementById("result-panel");
panel.innerHTML="";
model.getClassLabels().forEach(label=>{
const safeId=label.replace(/\s+/g,'');
panel.innerHTML+=`
<div class="result-row">
<div>${label}</div>
<div class="progress-track">
<span class="percent-text" id="text-${safeId}">0%</span>
<div class="progress-fill" id="bar-${safeId}"></div>
</div>
</div>
`;
});
}

/* Tabs */
function showCamera(){
document.getElementById("cameraPage").style.display="flex";
document.getElementById("infoPage").style.display="none";
setActiveTab(0);
}

function showInfo(){
document.getElementById("cameraPage").style.display="none";
document.getElementById("infoPage").style.display="block";
setActiveTab(1);
}

function setActiveTab(index){
document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
document.querySelectorAll(".tab")[index].classList.add("active");
}

/* ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á */
async function toggleCamera(){
if(isCameraOn){
await stopCamera();
}else{
await startCamera();
}
}

async function startCamera(){

const flip = currentFacingMode === "user";

webcam = new tmImage.Webcam(400,400,flip);
await webcam.setup({facingMode:currentFacingMode});
await webcam.play();

document.getElementById("webcam-container").innerHTML="";
document.getElementById("webcam-container").appendChild(webcam.canvas);

document.getElementById("placeholder").style.display="none";
document.getElementById("switchBtn").style.display="block";

isCameraOn=true;
loop();
}

async function stopCamera(){
if(loopId) cancelAnimationFrame(loopId);
if(webcam) await webcam.stop();

document.getElementById("webcam-container").innerHTML="";
document.getElementById("placeholder").style.display="block";
document.getElementById("switchBtn").style.display="none";

resetBars();
isCameraOn=false;
}

/* ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á */
async function switchCamera(){

if(!isCameraOn) return;

currentFacingMode =
currentFacingMode==="environment" ? "user" : "environment";

await webcam.stop();

const flip = currentFacingMode === "user";

webcam = new tmImage.Webcam(400,400,flip);
await webcam.setup({facingMode:currentFacingMode});
await webcam.play();

document.getElementById("webcam-container").innerHTML="";
document.getElementById("webcam-container").appendChild(webcam.canvas);
}

/* Loop */
async function loop(){
if(!isCameraOn) return;
webcam.update();
await predict();
loopId=requestAnimationFrame(loop);
}

/* Predict */
async function predict(){
const prediction=await model.predict(webcam.canvas);
prediction.forEach(p=>{
const percent=Math.round(p.probability*100);
updateBar(p.className,percent);
});
}

function updateBar(label,percent){
const safeId=label.replace(/\s+/g,'');
const bar=document.getElementById("bar-"+safeId);
const text=document.getElementById("text-"+safeId);
if(bar){
bar.style.width=percent+"%";
text.innerText=percent+"%";
}
}

function resetBars(){
document.querySelectorAll(".progress-fill").forEach(e=>e.style.width="0%");
document.querySelectorAll(".percent-text").forEach(e=>e.innerText="0%");
}

</script>
</body>
</html>
